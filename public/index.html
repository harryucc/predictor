<!DOCTYPE html>
<html lang="en">
<head>
  <!-- TEMP: comment out AdSense while debugging
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7429797559685152" crossorigin="anonymous"></script>
  -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Points Probability Calculator — Wizard</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"/>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root{
      --bg:#f5f6f7; --card:#fff; --border:#e5e7eb; --text:#333; --muted:#6c757d;
      --accent-green:#dff3e4; --accent-green-border:#9bd3ae; --accent:#adb5bd;
    }
    body{background:var(--bg); color:var(--text);}
    .card{border-color:var(--border); box-shadow:0 4px 14px rgba(0,0,0,.04);}
    .btn-main{background:#6c757d; color:#fff; border:none;}
    .btn-main:hover{background:#5c636a;}
    .step-badge{background:#eef1f4; border:1px solid #e5e7eb; border-radius:999px; padding:.25rem .6rem; font-weight:600; color:#495057;}
    .row-complete{background:var(--accent-green) !important;}
    .grade-pill{
      border:1px solid var(--border); border-radius:0; padding:1rem 0; cursor:pointer;
      background:#fff; font-weight:700; width:100%; text-align:center;
    }
    .grade-pill small{display:block; font-weight:500; color:#666;}
    .grade-pill.active{outline:2px solid var(--accent-green-border);}
    .keypad .btn{min-width:64px; min-height:48px; font-weight:600;}
    .progress{height:.7rem;}
    .badge-chip{background:#f1f3f5; color:#495057; border:1px solid #e9ecef; border-radius:9999px; padding:0 .5rem; margin:.1rem; display:inline-block;}
    #histogram{max-height:420px;}
    .navbar-light{background:#ffffff; border-bottom:1px solid var(--border);}
    .letter-filter{display:flex; flex-wrap:wrap; gap:4px; margin-top:.25rem;}
    .letter-filter button{border:none;background:#f1f3f5;padding:2px 6px;font-size:.8rem;cursor:pointer;}
    .letter-filter button.active{background:#ced4da;}
    .ad-box{
      background:#ffffff; border:1px solid var(--border); border-radius:.5rem;
      min-height:600px; position:sticky; top:72px; display:flex; align-items:center; justify-content:center;
      color:#6c757d; font-weight:600;
    }
    .ad-box .ad-inner{width:100%; height:100%; display:flex; align-items:center; justify-content:center; padding:8px;}
    .nav-actions .btn-lg{font-weight:600;}
    @media (max-width: 576px){
      .nav-actions .btn-lg{width:100%;}
    }
    @media (max-width: 991.98px){
      .ad-box{position:relative; top:auto; min-height:120px; margin-bottom:1rem;}
    }
    /* Tiny error overlay */
    #errOverlay{position:fixed;left:0;right:0;bottom:0;z-index:9999;background:#fee;border-top:1px solid #f5c2c7;color:#842029;padding:.5rem 1rem;font-size:.9rem;display:none}
    #errOverlay pre{white-space:pre-wrap;margin:0}
  </style>
</head>
<body>

  <div id="errOverlay"><strong>Script error:</strong> <pre id="errText"></pre></div>

  <!-- Tutorial Modal -->
  <div class="modal fade" id="tutorialModal" tabindex="-1" aria-labelledby="tutorialLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="tutorialLabel">Welcome</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p>Enter each subject one at a time, pick probabilities for each grade in the subject, go through each subject and then find out the likelihood of your expected points.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-main" data-bs-dismiss="modal">Got it</button>
        </div>
      </div>
    </div>
  </div>

  <!-- NAVBAR -->
  <nav class="navbar navbar-light sticky-top">
    <div class="container-fluid">
      <a class="navbar-brand fw-semibold" href="#" style="color:#333;">LC Points</a>
      <div class="d-flex align-items-center gap-3">
        <a class="text-muted text-decoration-none" href="about.html">About</a>
        <a class="text-muted text-decoration-none" href="privacy.html">Privacy</a>
      </div>
    </div>
  </nav>

  <!-- LAYOUT: side ads + main -->
  <div class="container-fluid">
    <div class="row g-3">
      <!-- Left ad (desktop) -->
      <aside class="col-lg-2 d-none d-lg-block">
        <div class="ad-box"><div class="ad-inner"><span>Ad Banner</span></div></div>
      </aside>

      <!-- Main content -->
      <main class="col-12 col-lg-8">
        <div class="py-3">
          <header class="mb-3 text-center">
            <h1 class="h4 mb-3">Points Probability Calculator</h1>
            <div class="d-flex flex-column align-items-center gap-2">
              <div>
                <label class="form-label mb-0">Target Points</label>
                <input id="target" type="number" class="form-control mx-auto" style="max-width:200px" placeholder="e.g. 500" required>
              </div>
              <div>
                <label class="form-label mb-0">School</label>
                <input id="school" class="form-control mx-auto" style="max-width:300px" placeholder="Type your school">
              </div>
            </div>
            <p class="text-muted mt-2 mb-0">Tap a grade (H1–H8 or O1–O8), then set its probability with the % grid or enter it manually below. The bar fills to 100%. Bonus points are applied automatically for Higher level Mathematics.</p>
          </header>

          <!-- Wizard Card -->
          <div id="wizard" class="card mb-4">
            <div class="card-header bg-white d-flex align-items-center justify-content-between">
              <div>
                <span class="step-badge"><span id="stepNow">1</span>/<span id="stepTotal">6</span></span>
                <span class="ms-2 fw-semibold">Subject Setup</span>
              </div>
              <div class="text-muted small">Complete each subject to 100%.</div>
            </div>
            <div class="card-body">
              <div class="row g-4">
                <!-- Subject meta + grades -->
                <div class="col-12">
                  <div id="subjectCard" class="p-3 rounded" style="background:#fff; border:1px solid var(--border);">
                    <div class="row g-3">
                      <div class="col-12 col-md-8">
                        <label class="form-label">Subject Name</label>
                        <input id="subName" class="form-control" list="subjectList" placeholder="">
                        <datalist id="subjectList"></datalist>
                        <div id="subjectLetters" class="letter-filter"></div>
                      </div>
                      <div class="col-12 col-md-4">
                        <label class="form-label">Level</label>
                        <select id="subLevel" class="form-select">
                          <option value="Higher" selected>Higher</option>
                          <option value="Ordinary">Ordinary</option>
                        </select>
                      </div>

                      <!-- Grade pills -->
                      <div class="col-12">
                        <div id="gradePills" class="d-grid" style="grid-template-columns: repeat(4, 1fr); gap: .5rem;"></div>
                      </div>

                      <!-- Remaining meter -->
                      <div class="col-12">
                        <div class="d-flex align-items-center justify-content-between">
                          <div>
                            <div class="small text-muted mb-1">Remaining</div>
                            <div id="remainingLabel" class="fw-semibold">100.0%</div>
                          </div>
                          <div class="flex-grow-1 mx-3">
                            <div class="progress">
                              <div id="remainingBar" class="progress-bar bg-success" role="progressbar" style="width: 0%"></div>
                            </div>
                          </div>
                          <div class="d-flex gap-2">
                            <button id="fillRemaining" class="btn btn-sm btn-outline-secondary">Fill Remaining</button>
                            <button id="clearSubject" class="btn btn-sm btn-outline-secondary">Clear</button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Probability controls -->
                <div class="col-12">
                  <label class="form-label">Set probability for the selected grade</label>

                  <div class="mb-3">
                    <label for="probInput" class="form-label">Manual Probability</label>
                    <div class="input-group">
                      <input id="probInput" class="form-control" placeholder="e.g. 70 or 0.7">
                      <button id="kpSet" class="btn btn-main" type="button">Set Value for Selected Grade</button>
                    </div>
                  </div>

                  <!-- Percent grid -->
                  <div class="mb-3">
                    <div class="d-grid gap-2" style="grid-template-columns: repeat(3, 1fr); display:grid;">
                      <button class="btn btn-outline-secondary pct" data-p="80">80%</button>
                      <button class="btn btn-outline-secondary pct" data-p="90">90%</button>
                      <button class="btn btn-outline-secondary pct" data-p="100">100%</button>
                      <button class="btn btn-outline-secondary pct" data-p="50">50%</button>
                      <button class="btn btn-outline-secondary pct" data-p="60">60%</button>
                      <button class="btn btn-outline-secondary pct" data-p="70">70%</button>
                      <button class="btn btn-outline-secondary pct" data-p="20">20%</button>
                      <button class="btn btn-outline-secondary pct" data-p="30">30%</button>
                      <button class="btn btn-outline-secondary pct" data-p="40">40%</button>
                      <button class="btn btn-outline-secondary pct" data-p="0">0%</button>
                      <button class="btn btn-outline-secondary pct" data-p="10">10%</button>
                    </div>
                  </div>
                </div>
              </div>

              <hr class="my-4"/>

              <div class="nav-actions d-flex flex-wrap gap-2 justify-content-between">
                <div class="d-flex flex-wrap gap-2 flex-grow-1">
                  <button id="prevBtn" class="btn btn-outline-secondary btn-lg flex-fill">&larr; Previous</button>
                  <button id="nextBtn" class="btn btn-outline-secondary btn-lg flex-fill">Next &rarr;</button>
                  <button id="addBtn" class="btn btn-outline-secondary btn-lg flex-fill">+ Add Subject</button>
                </div>
                <div class="flex-grow-1 flex-md-grow-0">
                  <button id="finishBtn" class="btn btn-main btn-lg w-100">Finish & Calculate</button>
                </div>
                <span class="w-100 text-muted small">We’ll use your best 6 subjects when calculating.</span>
              </div>
            </div>
          </div>

          <!-- Selection / Results / Chart -->
          <div class="card mb-3">
            <div class="card-body">
              <div id="selectionNote" class="text-muted">No results yet — complete a few subjects and click <b>Finish & Calculate</b>.</div>
            </div>
          </div>

          <div class="row g-3">
            <div class="col-12 col-lg-4">
              <div class="card h-100">
                <div class="card-header bg-white fw-semibold">Results</div>
                <div class="card-body">
                  <div id="results" class="text-muted">Awaiting input…</div>
                </div>
              </div>
            </div>
            <div class="col-12 col-lg-8">
              <div class="card h-100">
                <div class="card-header bg-white fw-semibold">Probability Distribution</div>
                <div class="card-body">
                  <canvas id="histogram" height="340"></canvas>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>

      <!-- Right ad (desktop) -->
      <aside class="col-lg-2 d-none d-lg-block">
        <div class="ad-box"><div class="ad-inner"><span>Ad Banner</span></div></div>
      </aside>

      <!-- Mobile ad -->
      <aside class="col-12 d-lg-none">
        <div class="ad-box"><div class="ad-inner"><span>Ad Banner</span></div></div>
      </aside>
    </div>
  </div>

  <footer class="text-center my-4">
    <a href="about.html">About</a> · <a href="privacy.html">Privacy</a>
  </footer>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-auth-compat.js"></script>
  <!-- Your app JS (defer so DOM exists) -->
  <script src="app.js" defer></script>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7429797559685152"
     crossorigin="anonymous"></script>
</body>
</html>
